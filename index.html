<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2¬∫ BPM ‚Äì Efetivo Extra Carnaval 2026</title>

    <style>
        body{
            font-family: Arial, Helvetica, sans-serif;
            background:#f4f6f8;
            margin:0;
            color:#1f2937;
        }

        /* ====== TELA DE VALIDA√á√ÉO ====== */
        .acesso-overlay{
            position: fixed;
            inset: 0;
            background:#0f172a;
            display:flex;
            align-items:center;
            justify-content:center;
            z-index:9999;
        }

        .acesso-box{
            background:#fff;
            padding:24px;
            border-radius:8px;
            width:320px;
            text-align:center;
            box-shadow:0 10px 25px rgba(0,0,0,.45);
        }

        .acesso-box h2{
            margin-bottom:16px;
            font-size:18px;
            color:#0f172a;
        }

        .acesso-box input{
            width:100%;
            padding:10px;
            margin-bottom:10px;
            border-radius:6px;
            border:1px solid #cbd5e1;
            font-size:14px;
        }

        .acesso-box button{
            width:100%;
            padding:10px;
            background:#0f172a;
            color:#fff;
            border:none;
            border-radius:6px;
            font-size:14px;
            cursor:pointer;
        }

        .acesso-box button:hover{
            background:#020617;
        }

        #erroAcesso{
            color:#dc2626;
            font-size:13px;
            margin-top:8px;
        }

        .acesso-box small{
            display:block;
            margin-top:12px;
            font-size:11px;
            color:#64748b;
        }

        /* ====== SITE ====== */
        header{
            background:#0f172a;
            color:#fff;
            padding:20px;
            text-align:center;
        }

        .brasao{
            width:110px;
            margin-bottom:10px;
            display:block;
            margin-left:auto;
            margin-right:auto;
        }

        header h1{
            margin:0;
            font-size:22px;
        }

        header p{
            margin-top:5px;
            font-size:14px;
            opacity:.9;
        }

        .container{
            max-width:1200px;
            margin:auto;
            padding:20px;
        }

        .controls{
            display:flex;
            gap:15px;
            flex-wrap:wrap;
            margin-bottom:15px;
        }

        .search{
            flex:1;
            position:relative;
        }

        .search input{
            width:100%;
            padding:10px 38px 10px 10px;
            font-size:15px;
            border-radius:6px;
            border:1px solid #cbd5e1;
        }

        .search span{
            position:absolute;
            right:12px;
            top:50%;
            transform:translateY(-50%);
            font-size:18px;
            color:#64748b;
        }

        .filtros-dia{
            display:flex;
            gap:8px;
            flex-wrap:wrap;
            margin-bottom:20px;
        }

        .filtros-dia button{
            padding:6px 12px;
            border:1px solid #0f172a;
            background:#fff;
            color:#0f172a;
            border-radius:5px;
            cursor:pointer;
            font-size:13px;
        }

        .filtros-dia button:hover,
        .filtros-dia button.ativo{
            background:#0f172a;
            color:#fff;
        }

        .day{
            background:#fff;
            border-radius:8px;
            padding:15px;
            margin-bottom:30px;
            box-shadow:0 2px 5px rgba(0,0,0,.05);
        }

        .day h2{
            margin:0 0 10px;
            border-bottom:2px solid #0f172a;
            padding-bottom:5px;
        }

        .city{
            margin-top:15px;
        }

        .city h3{
            margin-bottom:8px;
            color:#0f172a;
        }

        table{
            width:100%;
            border-collapse:collapse;
            font-size:14px;
        }

        th, td{
            border:1px solid #e5e7eb;
            padding:7px;
            text-align:left;
        }

        th{
            background:#f1f5f9;
        }

        footer{
            text-align:center;
            font-size:12px;
            color:#64748b;
            margin:30px 0 10px;
        }

        @media (max-width: 768px){
            table{ font-size:11px; table-layout:fixed; }
            th, td{ padding:4px 3px; word-break:break-word; }
            th:nth-child(1), td:nth-child(1){ width:32px; text-align:center; }
            th:nth-child(2), td:nth-child(2){ width:55px; text-align:center; }
            th:nth-child(4), td:nth-child(4){ width:70px; text-align:center; font-size:10px; }
            th:nth-child(6), td:nth-child(6){ width:60px; text-align:center; white-space:nowrap; }
        }
    </style>
</head>

<body>

<!-- ====== VALIDA√á√ÉO DE ACESSO ====== -->
<div id="acesso" class="acesso-overlay">
    <div class="acesso-box">
        <h2>Valida√ß√£o de Acesso Funcional</h2>

        <input type="text" id="nomeAcesso" placeholder="Primeiro nome">
        <input type="text" id="matriculaAcesso" placeholder="Matr√≠cula completa">

        <button onclick="validarAcesso()">Acessar</button>

        <p id="erroAcesso"></p>

        <small>
            Valida√ß√£o realizada exclusivamente com dados funcionais constantes em escala oficial,
            para consulta interna, conforme a Lei n¬∫ 13.709/2018 (LGPD).
        </small>
    </div>
</div>

<header>
    <img src="brasao_pmrn.png" alt="Bras√£o 2¬∫ BPM" class="brasao">
    <h1>2¬∫ BPM ‚Äì Efetivo Extra Refor√ßo Carnaval 2026</h1>
    <p>Mossor√≥ ‚Ä¢ Tibau ‚Ä¢ Grossos ‚Ä¢ Gov. Dix-Sept Rosado</p>
</header>

<div class="container">

    <div class="controls">
        <div class="search">
            <input type="text" id="searchInput" placeholder="Buscar por nome ou matr√≠cula">
            <span>üîç</span>
        </div>
    </div>

    <div class="filtros-dia">
        <button class="ativo" onclick="filtrarDia('', this)">Todos</button>
        <button onclick="filtrarDia('13', this)">Dia 13</button>
        <button onclick="filtrarDia('14', this)">Dia 14</button>
        <button onclick="filtrarDia('15', this)">Dia 15</button>
        <button onclick="filtrarDia('16', this)">Dia 16</button>
        <button onclick="filtrarDia('17', this)">Dia 17</button>
        <button onclick="filtrarDia('18', this)">Dia 18</button>
    </div>

    <div id="conteudo"></div>
</div>

<footer>
    Consulta interna de efetivo ‚Ä¢ Dados minimizados conforme LGPD
</footer>

<script>
/* ===== FUN√á√ïES UTILIT√ÅRIAS ===== */
function normalizar(txt){
    return txt
        .normalize('NFD')
        .replace(/[\u0300-\u036f]/g,'')
        .toUpperCase()
        .trim();
}

function mascaraMatricula(mat){
    const clean = mat.replace(/\D/g,'');
    return clean.length >= 6
        ? clean.substring(0,3) + '***' + clean.substring(6)
        : mat;
}

/* ===== DADOS ===== */
let dados = [];
let dadosAcesso = [];
let diaSelecionado = '';

fetch('./efetivo2.csv?v=' + Date.now())
    .then(res => res.text())
    .then(text => {
        const linhas = text.replace(/^\uFEFF/,'').split(/\r?\n/).filter(l => l.trim());
        let sep = ';';
        if(linhas[0].includes(',')) sep = ',';
        if(linhas[0].includes('\t')) sep = '\t';

        linhas.shift();

        dados = linhas.map(l => {
            const c = l.split(sep).map(v => v.trim());
            return {
                DIA: c[0] || '',
                ORDEM: c[1] || '',
                GRADUACAO: c[2] || '',
                NOME: c[3] || '',
                MATRICULA: c[4] || '',
                OPM: c[5] || '',
                TIPO: c[6] || '',
                LOCAL: c[7] || ''
            };
        });

        dadosAcesso = dados.map(d => ({
            primeiroNome: normalizar(d.NOME).split(' ')[0],
            matricula: d.MATRICULA.replace(/\D/g,'')
        }));

        render();
    });

/* ===== VALIDA√á√ÉO ===== */
function validarAcesso(){
    const nome = normalizar(document.getElementById('nomeAcesso').value);
    const matricula = document.getElementById('matriculaAcesso').value.replace(/\D/g,'');

    const ok = dadosAcesso.some(p =>
        p.primeiroNome === nome && p.matricula === matricula
    );

    if(ok){
        document.getElementById('acesso').style.display = 'none';
    } else {
        document.getElementById('erroAcesso').innerText =
            'Dados n√£o localizados na escala.';
    }
}

/* ===== FILTROS ===== */
document.getElementById('searchInput').addEventListener('input', render);

function filtrarDia(valor, botao){
    diaSelecionado = valor;
    document.querySelectorAll('.filtros-dia button')
        .forEach(b => b.classList.remove('ativo'));
    botao.classList.add('ativo');
    render();
}

function render(){
    const filtro = normalizar(document.getElementById('searchInput').value);
    const div = document.getElementById('conteudo');
    div.innerHTML = '';

    const filtrado = dados.filter(d => {
        const nomeOk =
            normalizar(d.NOME).includes(filtro) ||
            d.MATRICULA.includes(filtro);

        const diaCSV = (d.DIA.match(/\d+/) || [''])[0];
        const diaOk = diaSelecionado === '' || diaCSV === diaSelecionado;

        return nomeOk && diaOk;
    });

    const porDia = {};
    filtrado.forEach(d => {
        if(!porDia[d.DIA]) porDia[d.DIA] = {};
        if(!porDia[d.DIA][d.LOCAL]) porDia[d.DIA][d.LOCAL] = [];
        porDia[d.DIA][d.LOCAL].push(d);
    });

    Object.keys(porDia).forEach(dia => {
        const blocoDia = document.createElement('div');
        blocoDia.className = 'day';
        blocoDia.innerHTML = `<h2>üìÖ Dia ${dia}</h2>`;

        Object.keys(porDia[dia]).forEach(local => {
            let html = `
                <div class="city">
                <h3>üìç ${local}</h3>
                <table>
                <tr>
                    <th>Ord.</th>
                    <th>Grad.</th>
                    <th>Nome</th>
                    <th>Mat.</th>
                    <th>OPM</th>
                    <th>Tipo</th>
                </tr>
            `;

            porDia[dia][local].forEach(p => {
                html += `
                <tr>
                    <td>${p.ORDEM}</td>
                    <td>${p.GRADUACAO}</td>
                    <td>${p.NOME}</td>
                    <td>${mascaraMatricula(p.MATRICULA)}</td>
                    <td>${p.OPM}</td>
                    <td>${p.TIPO}</td>
                </tr>`;
            });

            html += `</table></div>`;
            blocoDia.innerHTML += html;
        });

        div.appendChild(blocoDia);
    });
}
</script>

</body>
</html>
