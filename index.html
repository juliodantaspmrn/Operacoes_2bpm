<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>2¬∫ BPM ‚Äì Efetivo Extra Carnaval 2026</title>

<style>
body{
    font-family: Arial, Helvetica, sans-serif;
    background:#f4f6f8;
    margin:0;
    color:#1f2937;
}

/* ===== LOGIN ===== */
#acesso{
    position:fixed;
    inset:0;
    background:#0f172a;
    display:flex;
    align-items:center;
    justify-content:center;
    z-index:9999;
}
.acesso-box{
    background:#fff;
    padding:24px;
    border-radius:8px;
    width:320px;
    text-align:center;
}
.acesso-box h2{
    margin-bottom:14px;
    color:#0f172a;
}
.acesso-box input{
    width:100%;
    padding:10px;
    margin-bottom:10px;
    border-radius:6px;
    border:1px solid #cbd5e1;
}
.acesso-box button{
    width:100%;
    padding:10px;
    background:#0f172a;
    color:#fff;
    border:none;
    border-radius:6px;
    cursor:pointer;
}
#acessoErro{
    color:#dc2626;
    font-size:13px;
    margin-top:6px;
}

/* ===== SITE ===== */
header{
    background:#0f172a;
    color:#fff;
    padding:20px;
    text-align:center;
}
.brasao{
    width:110px;
    margin-bottom:10px;
}
.container{
    max-width:1200px;
    margin:auto;
    padding:20px;
}

.search{
    position:relative;
    margin-bottom:10px;
}
.search input{
    width:100%;
    padding:10px 38px 10px 10px;
    border-radius:6px;
    border:1px solid #cbd5e1;
}
.search span{
    position:absolute;
    right:12px;
    top:50%;
    transform:translateY(-50%);
}

.filtros-dia{
    display:flex;
    gap:8px;
    flex-wrap:wrap;
    margin-bottom:20px;
}
.filtros-dia button{
    padding:6px 12px;
    border:1px solid #0f172a;
    background:#fff;
    border-radius:5px;
    cursor:pointer;
}
.filtros-dia button.ativo{
    background:#0f172a;
    color:#fff;
}

.day{
    background:#fff;
    padding:15px;
    margin-bottom:25px;
    border-radius:8px;
}
.city{
    margin-top:12px;
}

table{
    width:100%;
    border-collapse:collapse;
    font-size:14px;
}
th,td{
    border:1px solid #e5e7eb;
    padding:6px;
}

footer{
    text-align:center;
    font-size:12px;
    color:#64748b;
    margin:25px 0;
}

@media (max-width:768px){
    table{
        font-size:11px;
        table-layout:fixed;
    }
    th,td{
        word-break:break-word;
        padding:4px;
    }
}
</style>
</head>

<body>

<!-- LOGIN -->
<div id="acesso">
    <div class="acesso-box">
        <h2>Valida√ß√£o de Acesso Funcional</h2>
        <input id="nomeAcesso" placeholder="Primeiro nome">
        <input id="matAcesso" placeholder="Matr√≠cula completa">
        <button id="btnAcessar" onclick="validarAcesso()" disabled>Acessar</button>
        <div id="acessoErro"></div>
        <small style="font-size:11px;color:#64748b">
            Consulta interna ‚Ä¢ Dados de escala oficial ‚Ä¢ LGPD
        </small>
    </div>
</div>

<header>
    <img src="brasao_pmrn.png" class="brasao">
    <h2>2¬∫ BPM ‚Äì Efetivo Extra Carnaval 2026</h2>
    <p>Mossor√≥ ‚Ä¢ Tibau ‚Ä¢ Grossos ‚Ä¢ Gov. Dix-Sept Rosado</p>
</header>

<div class="container">

<div class="search">
    <input id="searchInput" placeholder="Buscar por nome ou matr√≠cula">
    <span>üîç</span>
</div>

<div class="filtros-dia">
    <button class="ativo" onclick="filtrarDia('',this)">Todos</button>
    <button onclick="filtrarDia('13',this)">Dia 13</button>
    <button onclick="filtrarDia('14',this)">Dia 14</button>
    <button onclick="filtrarDia('15',this)">Dia 15</button>
    <button onclick="filtrarDia('16',this)">Dia 16</button>
    <button onclick="filtrarDia('17',this)">Dia 17</button>
    <button onclick="filtrarDia('18',this)">Dia 18</button>
</div>

<div id="conteudo"></div>
</div>

<footer>
Consulta interna de efetivo ‚Ä¢ Dados minimizados conforme LGPD
</footer>

<script>
/* ===== UTIL ===== */
function limpar(txt){
    return (txt||'').replace(/\u00A0/g,' ').trim();
}
function normalizar(txt){
    return limpar(txt)
        .normalize('NFD')
        .replace(/[\u0300-\u036f]/g,'')
        .toUpperCase();
}

/* ===== VARI√ÅVEIS ===== */
let dados = [];
let dadosAcesso = [];
let diaSelecionado = '';

/* ===== CSV ===== */
fetch('./efetivo2.csv?v=' + Date.now())
    .then(r => r.text())
    .then(parseCSV);

function parseCSV(text){
    const linhas = text.replace(/^\uFEFF/,'')
        .split(/\r?\n/)
        .filter(l => l.trim() !== '');

    const sep = linhas[0].includes(';') ? ';' :
                linhas[0].includes(',') ? ',' : '\t';

    const headers = linhas.shift()
        .split(sep)
        .map(h => normalizar(h));

    dados = linhas.map(l => {
        const valores = l.split(sep).map(limpar);
        const obj = {};
        headers.forEach((h,i) => obj[h] = valores[i] || '');

        return {
            DIA: obj['DIA'],
            ORDEM: obj['ORDEM'],
            GRAD: obj['GRADUA√á√ÉO'],
            NOME: obj['NOME COMPLETO'],
            MAT: obj['MATR√çCULA'],
            OPM: obj['OPM'],
            TIPO: obj['TIPO DE POLICIAMENTO'],
            LOCAL: obj['LOCAL']
        };
    });

    dadosAcesso = dados.map(d => ({
        nome: normalizar(d.NOME).split(' ')[0],
        mat: d.MAT.replace(/\D/g,'')
    }));

    document.getElementById('btnAcessar').disabled = false;
    render();
}

/* ===== LOGIN ===== */
function validarAcesso(){
    if(!dadosAcesso.length){
        acessoErro.innerText = 'Aguarde o carregamento da escala.';
        return;
    }

    const nome = normalizar(nomeAcesso.value);
    const mat = matAcesso.value.replace(/\D/g,'');

    const ok = dadosAcesso.some(p => p.nome === nome && p.mat === mat);

    if(ok){
        document.getElementById('acesso').style.display = 'none';
    }else{
        acessoErro.innerText = 'Dados n√£o localizados na escala.';
    }
}

/* ===== FILTROS ===== */
searchInput.addEventListener('input', render);

function filtrarDia(dia, botao){
    diaSelecionado = dia;
    document.querySelectorAll('.filtros-dia button')
        .forEach(b => b.classList.remove('ativo'));
    botao.classList.add('ativo');
    render();
}

/* ===== RENDER ===== */
function render(){
    const filtro = normalizar(searchInput.value);
    conteudo.innerHTML = '';

    const filtrado = dados.filter(d => {
        const nomeOk =
            normalizar(d.NOME).includes(filtro) ||
            d.MAT.includes(filtro);

        const diaCSV = (d.DIA.match(/\d+/) || [''])[0];
        const diaOk = !diaSelecionado || diaCSV === diaSelecionado;

        return nomeOk && diaOk;
    });

    const mapa = {};
    filtrado.forEach(d => {
        mapa[d.DIA] ??= {};
        mapa[d.DIA][d.LOCAL] ??= [];
        mapa[d.DIA][d.LOCAL].push(d);
    });

    for(const dia in mapa){
        const bloco = document.createElement('div');
        bloco.className = 'day';
        bloco.innerHTML = `<h3>üìÖ Dia ${dia}</h3>`;

        for(const local in mapa[dia]){
            let html = `
            <div class="city">
            <h4>üìç ${local}</h4>
            <table>
            <tr>
                <th>Ord</th>
                <th>Grad</th>
                <th>Nome</th>
                <th>Mat</th>
                <th>OPM</th>
                <th>Tipo</th>
            </tr>`;

            mapa[dia][local].forEach(p => {
                html += `
                <tr>
                    <td>${p.ORDEM}</td>
                    <td>${p.GRAD}</td>
                    <td>${p.NOME}</td>
                    <td>${p.MAT.replace(/\d(?=\d{4})/g,'*')}</td>
                    <td>${p.OPM}</td>
                    <td>${p.TIPO}</td>
                </tr>`;
            });

            html += '</table></div>';
            bloco.innerHTML += html;
        }

        conteudo.appendChild(bloco);
    }
}
</script>

</body>
</html>
