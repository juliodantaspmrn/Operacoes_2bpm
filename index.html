<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>2º BPM – Efetivo Extra Carnaval 2026</title>

<style>
body{
    font-family: Arial, Helvetica, sans-serif;
    background:#f4f6f8;
    margin:0;
    color:#1f2937;
}

header{
    background:#0f172a;
    color:#fff;
    padding:20px;
    text-align:center;
}

.container{
    max-width:1200px;
    margin:auto;
    padding:20px;
}

.login{
    max-width:360px;
    margin:80px auto;
    background:#fff;
    padding:25px;
    border-radius:8px;
    box-shadow:0 4px 10px rgba(0,0,0,.1);
}

.login h2{
    text-align:center;
    margin-bottom:20px;
}

.login input{
    width:100%;
    padding:10px;
    margin-bottom:12px;
    border-radius:5px;
    border:1px solid #cbd5e1;
}

.login button{
    width:100%;
    padding:10px;
    background:#0f172a;
    color:#fff;
    border:none;
    border-radius:5px;
    font-size:15px;
    cursor:pointer;
}

.login p{
    color:red;
    text-align:center;
    display:none;
}

.hidden{ display:none; }

/* ======= TABELA ======= */

.search input{
    width:100%;
    padding:10px;
    margin-bottom:15px;
}

.day{
    background:#fff;
    border-radius:8px;
    padding:15px;
    margin-bottom:30px;
}

table{
    width:100%;
    border-collapse:collapse;
    font-size:14px;
}

th, td{
    border:1px solid #e5e7eb;
    padding:7px;
}
th{ background:#f1f5f9; }

footer{
    text-align:center;
    font-size:12px;
    color:#64748b;
    margin:30px 0;
}
</style>
</head>

<body>

<header>
    <h1>2º BPM – Efetivo Extra Carnaval 2026</h1>
</header>

<!-- LOGIN -->
<div class="login" id="loginBox">
    <h2>Acesso ao Efetivo</h2>
    <input type="text" id="nomeLogin" placeholder="Primeiro nome">
    <input type="text" id="matLogin" placeholder="Matrícula">
    <button onclick="validarAcesso()">Acessar</button>
    <p id="erroLogin">Nome ou matrícula inválidos</p>
</div>

<!-- CONTEÚDO -->
<div class="container hidden" id="conteudoSite">
    <div class="search">
        <input type="text" id="searchInput" placeholder="Buscar por nome ou matrícula">
    </div>
    <div id="conteudo"></div>
</div>

<footer>
    Consulta interna de efetivo • Dados minimizados conforme LGPD
</footer>

<script>
let dados = [];
let dadosAcesso = [];

/* ===== NORMALIZA ===== */
function normalizar(txt){
    return (txt||'')
        .replace(/\u00A0/g,' ')
        .replace(/\s+/g,' ')
        .trim()
        .normalize('NFD')
        .replace(/[\u0300-\u036f]/g,'')
        .toUpperCase();
}

/* ===== CARREGA CSV ===== */
fetch('./efetivo2.csv')
.then(r => r.text())
.then(text => {
    const linhas = text.replace(/^\uFEFF/,'').split(/\r?\n/).filter(l=>l.trim());
    linhas.shift();

    dados = linhas.map(l=>{
        const c = l.split(';');
        return {
            DIA:c[0], ORDEM:c[1], GRAD:c[2], NOME:c[3], MAT:c[4],
            OPM:c[5], TIPO:c[6], LOCAL:c[7]
        };
    });

    dadosAcesso = dados.map(d=>({
        nome: normalizar(d.NOME).split(' ')[0],
        mat: d.MAT.replace(/\D/g,'')
    }));
});

/* ===== LOGIN ===== */
function validarAcesso(){
    const nome = normalizar(document.getElementById('nomeLogin').value).split(' ')[0];
    const mat = document.getElementById('matLogin').value.replace(/\D/g,'');

    const ok = dadosAcesso.some(d => d.nome === nome && d.mat === mat);

    if(ok){
        document.getElementById('loginBox').classList.add('hidden');
        document.getElementById('conteudoSite').classList.remove('hidden');
        render();
    }else{
        document.getElementById('erroLogin').style.display='block';
    }
}

/* ===== RENDER ===== */
document.getElementById('searchInput').addEventListener('input', render);

function render(){
    const f = document.getElementById('searchInput').value.toLowerCase();
    const div = document.getElementById('conteudo');
    div.innerHTML='';

    dados.filter(d =>
        d.NOME.toLowerCase().includes(f) ||
        d.MAT.includes(f)
    ).forEach(d=>{
        div.innerHTML += `
        <div class="day">
            <strong>${d.NOME}</strong><br>
            ${d.GRAD} • ${d.OPM} • ${d.LOCAL}
        </div>`;
    });
}
</script>

</body>
</html>
